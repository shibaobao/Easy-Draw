!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.FreeDraw=e():t.FreeDraw=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";i.r(e);var n={lineWidth:2,fillStyle:"#FFFFFF",strokeStyle:"#0E71EB",radius:5},s={lineWidth:2,fillStyle:"rgba(14, 113, 235, 0.25)",strokeStyle:"#0E71EB"},o={lineWidth:2,fillStyle:"rgba(14, 113, 235, 0.8)",strokeStyle:"rgba(14, 113, 235, 0.8)"};function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e.id,this.type=e.type,this.edit=e.edit||!0,this.active=e.active||!0,this.points=e.points||[],this.handlePoints=[],this.clickedHandlePointIndex=null,this.freeDraw=e.freeDraw,this.handlePointStyle=e.handlePointStyle,this.shapeStyle=e.shapeStyle,this.shape=null}var e,i,h;return e=t,(i=[{key:"_initShape",value:function(){this.handlePointStyle||(this.handlePointStyle=n),this.shapeStyle||(this.shapeStyle=s)}},{key:"_trigger",value:function(t){switch(t.type){case"mousedown":this._handleMouseDown&&"function"==typeof this._handleMouseDown&&this._handleMouseDown(t);break;case"mousemove":this._handleMouseMove&&"function"==typeof this._handleMouseMove&&this._handleMouseMove(t);break;case"mouseup":this._handleMouseUp&&"function"==typeof this._handleMouseUp&&this._handleMouseUp(t);break;case"click":this._handleClick&&"function"==typeof this._handleClick&&this._handleClick(t)}}},{key:"_drawHandlePoint",value:function(t,e,i,n){var s=new Path2D;return s.arc(t,e,i,0,2*Math.PI),this.freeDraw._updateCtxStyle(n),this.freeDraw.ctx.fill(s),this.freeDraw.ctx.stroke(s),s}},{key:"_includes",value:function(t,e){return this._pointInHandlePoints(t,e)||this._pointInShape(t,e)}},{key:"_pointInShape",value:function(t,e){return!!this.shape&&this.freeDraw.ctx.isPointInPath(this.shape,t,e)}},{key:"_pointInHandlePoints",value:function(t,e){var i=!1;if(this.edit){for(var n=null,s=0;s<this.handlePointsLength;s++)if(this.freeDraw.ctx.isPointInPath(this.handlePoints[s].obj,t,e)){i=!0,n=s;break}this.clickedHandlePointIndex=n}return i}},{key:"saveEdit",value:function(){return this.edit=!1,this.active=!0,this.freeDraw._updateModel("view"),this.shapeStyle=o,this.pointsToPath(),this.freeDraw._refreshShapesInCanvas(),this}}])&&a(e.prototype,i),h&&a(e,h),t}();function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=c(this,d(e).call(this,t))).handlePointsLength=8,i.startPoint=t.startPoint||[],i.width=t.width,i.height=t.height,i.points=[],i.path="",i.clickedShape=!1,i.clickedShapePoint=[],i.clickedHandlePoint=!1,i._initRect(),i}var i,n,s;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,h),i=e,(n=[{key:"_initRect",value:function(){this._initShape(),this.startPoint.length>0&&this.width&&this.height&&(this._generateHandlePointsByPoints(),this._draw())}},{key:"_generateHandlePointsByPoints",value:function(){var t=this._getZoomAndMoveRect(),e=t.startPoint,i=t.width,n=t.height;this.handlePoints[0]={obj:null,point:e},this.handlePoints[1]={obj:null,point:[e[0]+i/2,e[1]]},this.handlePoints[2]={obj:null,point:[e[0]+i,e[1]]},this.handlePoints[3]={obj:null,point:[e[0]+i,e[1]+n/2]},this.handlePoints[4]={obj:null,point:[e[0]+i,e[1]+n]},this.handlePoints[5]={obj:null,point:[e[0]+i/2,e[1]+n]},this.handlePoints[6]={obj:null,point:[e[0],e[1]+n]},this.handlePoints[7]={obj:null,point:[e[0],e[1]+n/2]}}},{key:"_draw",value:function(){this._generateHandlePointsByPoints(),this.shape=this._drawRect(),this.edit&&this._drawRectHandlePoints()}},{key:"_drawRectHandlePoints",value:function(){for(var t=0;t<this.handlePointsLength;t++)this.handlePoints[t].obj=this._drawHandlePoint(this.handlePoints[t].point[0],this.handlePoints[t].point[1],this.handlePointStyle.radius,{lineWidth:this.handlePointStyle.lineWidth,fillStyle:this.handlePointStyle.fillStyle,strokeStyle:this.handlePointStyle.strokeStyle})}},{key:"_drawRect",value:function(){var t=this._getZoomAndMoveRect(),e=t.startPoint,i=t.width,n=t.height,s=new Path2D;return s.rect(e[0],e[1],i,n),this.freeDraw._updateCtxStyle(this.shapeStyle),this.freeDraw.ctx.fill(s),this.freeDraw.ctx.stroke(s),s}},{key:"_handleMouseDown",value:function(t){var e=t.offsetX,i=t.offsetY;this._pointInHandlePoints(e,i)?(this.clickedHandlePoint=!0,this.clickedShape=!1,this.clickedShapePoint=[]):this._pointInShape(e,i)&&(this.clickedShape=!0,this.clickedShapePoint=[e,i],this.clickedHandlePoint=!1)}},{key:"_handleMouseMove",value:function(t){var e=t.offsetX,i=t.offsetY;if(this.clickedHandlePoint){var n=this.handlePoints[this.clickedHandlePointIndex].point;0===this.clickedHandlePointIndex?(this.width+=(n[0]-e)/this.freeDraw.zoomLevel,this.height+=(n[1]-i)/this.freeDraw.zoomLevel,this.startPoint=[this.startPoint[0]+(e-n[0])/this.freeDraw.zoomLevel,this.startPoint[1]+(i-n[1])/this.freeDraw.zoomLevel]):1===this.clickedHandlePointIndex?(this.height+=(n[1]-i)/this.freeDraw.zoomLevel,this.startPoint[1]+=(i-n[1])/this.freeDraw.zoomLevel):2===this.clickedHandlePointIndex?(this.width+=(e-n[0])/this.freeDraw.zoomLevel,this.height+=(n[1]-i)/this.freeDraw.zoomLevel,this.startPoint[1]+=(i-n[1])/this.freeDraw.zoomLevel):3===this.clickedHandlePointIndex?this.width+=e-n[0]:4===this.clickedHandlePointIndex?(this.width+=e-n[0],this.height+=i-n[1]):5===this.clickedHandlePointIndex?this.height+=i-n[1]:6===this.clickedHandlePointIndex?(this.width+=(n[0]-e)/this.freeDraw.zoomLevel,this.height+=(i-n[1])/this.freeDraw.zoomLevel,this.startPoint[0]+=(e-n[0])/this.freeDraw.zoomLevel):7===this.clickedHandlePointIndex&&(this.width+=(n[0]-e)/this.freeDraw.zoomLevel,this.startPoint[0]+=(e-n[0])/this.freeDraw.zoomLevel)}else this.clickedShape&&(this.startPoint=[this.startPoint[0]+(e-this.clickedShapePoint[0])/this.freeDraw.zoomLevel,this.startPoint[1]+(i-this.clickedShapePoint[1])/this.freeDraw.zoomLevel],this.clickedShapePoint=[e,i]);this._generateHandlePointsByPoints(),this.freeDraw._refreshShapesInCanvas()}},{key:"_handleMouseUp",value:function(){this.clickedShape=!1,this.clickedHandlePoint=!1,this.clickedShapePoint=[]}},{key:"_handleClick",value:function(){}},{key:"_getZoomAndMoveRect",value:function(){var t=this.width,e=this.height,i=this.startPoint[0],n=this.startPoint[1];return t=this.width*this.freeDraw.zoomLevel,e=this.height*this.freeDraw.zoomLevel,i=(this.startPoint[0]-this.freeDraw.transformCenter[0])*this.freeDraw.zoomLevel+this.freeDraw.transformCenter[0],n=(this.startPoint[1]-this.freeDraw.transformCenter[1])*this.freeDraw.zoomLevel+this.freeDraw.transformCenter[1],0!==this.freeDraw.offsetLeft&&(i+=this.freeDraw.offsetLeft),0!==this.freeDraw.offsetTop&&(n+=this.freeDraw.offsetTop),{width:t,height:e,startPoint:[i,n]}}},{key:"pointsToPath",value:function(){this.points[0]=this.startPoint,this.points[1]=[this.startPoint[0]+this.width,this.startPoint[1]],this.points[2]=[this.startPoint[0]+this.width,this.startPoint[1]+this.height],this.points[3]=[this.startPoint[0],this.startPoint[1]+this.height],this.path="M".concat(this.points[0].join(","),"L").concat(this.points[1].join(","),"L").concat(this.points[2].join(","),"L").concat(this.points[3].join(","),"Z")}}])&&l(i.prototype,n),s&&l(i,s),e}();function p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var v=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasDOM=e.canvas,this.eventsCallBack=e.eventsCallBack,this.ctx=null,this.model="view",this.editingId=null,this.isClickedShape=!1,this.clickedShapeId=null,this.shapeInCanvas={},this.zoomLevel=1,this.offsetTop=0,this.offsetLeft=0,this.transformCenter=[0,0],this._initFreeDraw()}var e,i,n;return e=t,(i=[{key:"_initFreeDraw",value:function(){this.ctx=this.canvasDOM.getContext("2d"),this.canvasDOM.addEventListener("mousedown",this._distributeEvents.bind(this)),this.canvasDOM.addEventListener("mousemove",this._distributeEvents.bind(this)),this.canvasDOM.addEventListener("mouseup",this._distributeEvents.bind(this)),this.canvasDOM.addEventListener("click",this._distributeEvents.bind(this))}},{key:"_distributeEvents",value:function(t){var e=t.type,i=t.offsetX,n=t.offsetY;if("view"===this.model){if("mousedown"===e)for(var s in this.shapeInCanvas){this.shapeInCanvas[s]._includes(i,n)&&(this.clickedShapeId=s,this.isClickedShape=!0)}else"mouseup"===e&&(this.clickedShapeId=null,this.isClickedShape=!1);if(this.eventsCallBack&&"function"==typeof this.eventsCallBack)for(var o in this.shapeInCanvas){this.shapeInCanvas[o]._includes(i,n)&&this.eventsCallBack(t,o)}}else if("edit"===this.model){var a=this.shapeInCanvas[this.editingId];a&&(a._trigger(t),"mousedown"===e?a._includes(i,n)&&(this.isClickedShape=!0,this.clickedShapeId=a.id):"mouseup"===e&&(this.isClickedShape=!1,this.clickedShapeId=null))}}},{key:"_updateCtxStyle",value:function(t){this.ctx.lineWidth=t.lineWidth,this.ctx.fillStyle=t.fillStyle,this.ctx.strokeStyle=t.strokeStyle}},{key:"removeShape",value:function(t){return this.shapeInCanvas[t]&&delete this.shapeInCanvas[t],this._refreshShapesInCanvas(),this}},{key:"removeAllShape",value:function(){return this.shapeInCanvas={},this._refreshShapesInCanvas(),this}},{key:"_updateModel",value:function(t,e){this.model=t||"view",this.editingId=e||null}},{key:"_clearCanvas",value:function(){return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this}},{key:"_refreshShapesInCanvas",value:function(){for(var t in this._clearCanvas(),this.shapeInCanvas)this.shapeInCanvas[t]._draw()}},{key:"zoomAndOffset",value:function(t,e,i,n){this.zoomLevel=t,this.offsetTop=n,this.offsetLeft=i,this.transformCenter=e,this._refreshShapesInCanvas()}},{key:"addShape",value:function(t){var e=t.type,i=t.id;if(!i)throw new Error("Shape id can not be empty");if(this.shapeInCanvas[i])throw new Error("Shape id must be unique, shape id '".concat(i,"' has already exist"));if(this._updateModel("edit",i),"rect"===e)return this.shapeInCanvas[i]=this._addRect(t),this.shapeInCanvas[i]}},{key:"_addRect",value:function(t){var e=t.id,i=t.type,n=t.shapeStyle,s=t.handlePointStyle,o=t.startPoint,a=t.width,h=t.height;console.log(e,i,n,s,o,a,h);var r=[];return o&&a&&h&&(r.push(o),r.push([o[0]+a,o[1]]),r.push([o[0]+a,o[1]+h]),r.push([o[0],o[1]+h])),new f({id:e,type:i,width:a,height:h,points:r,startPoint:o,shapeStyle:n,handlePointStyle:s,freeDraw:this})}}])&&p(e.prototype,i),n&&p(e,n),t}();e.default=v}])});